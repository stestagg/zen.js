!function(){"use strict";function t(e){return e.replace(g,"")}function r(e){return e.replace(u,function(e){return e.slice(1)})}function R(e,t){return e+="",e.length>=t?e:new Array(t-e.length+1).join("0")+e}function l(e,t){return e.replace(k,function(e){return"\\\\"==e?"\\":"\\$"==e?"\\$":R(t+1,e.length)})}function b(n,c){var i=n.split(C),e={type:"tag",tag:j,attr:{},classes:{},children:[],repeat:1};3==i.length&&(e.tag=i[1],n=i[2]);var a=n.split(I).filter(function(e){return e.length>0});a.forEach(function(n){var i=n.charAt(0);switch(i){case"#":e.attr.id=r(n.slice(1));break;case".":e.classes[r(n.slice(1))]=!0;break;case"[":n=n.slice(1,-1);var c=n.split(P);c.forEach(function(c){if(""!=c){c=t(c);var a=t(N.exec(c)[0]),i=c.slice(a.length);if(0==i.length)i="yes";else{if("="!=i.charAt(0))throw new Error("Invalid attribute specifier: "+n);i=i.slice(1),("'"==i.charAt(0)||'"'==i.charAt(0))&&(i=i.slice(1,-1))}e.attr[r(a)]=r(i)}});break;case"*":e.repeat=parseInt(n.slice(1));break;default:throw new Error("Unknown modifier: '"+n+"'")}}),c[0].children.push(e)}function m(n,e){switch(t(n)){case">":var i=e[0];return e.splice(0,0,i.children[i.children.length-1]),void 0;case"+":return;case"(":var c={type:"group",children:[],repeat:1};return e[0].children.push(c),e.splice(0,0,c),void 0;case")":for(var r=0;r<e.length&&"group"!=e[r].type;++r);if(r==e.length)throw new Error("Group closing brace found, but no matching opening brace");return e.splice(0,r),void 0;default:throw new Error("Operator not implemented '"+t(n)+"'")}}function y(c,n,a){var i=r(t(c).slice(1,-1)),e=n[0];"selector"==a&&e.children.length>0?e.children[e.children.length-1].children.push({type:"text",text:i,repeat:1}):n[0].children.push({type:"text",text:i,repeat:1})}function v(e,t,r){return"{"==e.charAt(0)?(y(e,t,r),"text"):$.test(e)?(m(e,t,r),"relationship"):(b(e,t),"selector")}function e(t){if(!(this instanceof e))return new e(t);var i=t.match(O),r={children:[]},c=[r],n=null;i.forEach(function(e){""!=e&&(n=v(e,c,n))}),this.definition=r}var g=/(^\s+)|(\s+$)/g,u=/\\./g,k=/(\\\\|\\\$|\$+)/g,p='"(?:(?:\\\\\\\\)|(?:\\\\")|(?:[^"]))*"',f="'(?:(?:\\\\\\\\)|(?:\\\\')|(?:[^']))*'",d="\\{(?:(?:\\\\\\\\)|(?:\\\\})|(?:[^\\}]))*\\}",n="(?:(?:\\\\.)|(?:[^>+()\\[\\=\\.\\#\\s\\*\\{]))+",w="(?:"+p+")|(?:"+f+")|(?:[^\\]]+)",o="\\s*"+n+"\\s*(?:=\\s*(?:"+w+"))?,?\\s*",E="\\[(?:"+o+")+\\]",a="\\w+",c="\\s*\\*\\s*\\d+",x="#"+n,h="\\."+n,i="(?:"+x+")|(?:"+h+")|(?:"+E+")",A="("+a+")?(?:"+i+")*("+c+")?",s="[>+()]("+c+")?",$=new RegExp(s),_="("+s+")|("+d+")|("+A+")",O=new RegExp(_,"gi"),j="div",C=new RegExp("^("+a+")"),I=new RegExp("("+i+")"),N=new RegExp("\\s*"+n+"\\s*"),P=new RegExp("("+o+")");e.prototype._make_node=function(e,i){if("text"==e.type)return document.createTextNode(e.text);if("tag"==e.type){var r=document.createElement(e.tag);for(var t in e.attr)e.attr.hasOwnProperty(t)&&r.setAttribute(t,l(e.attr[t],i));var n=[];for(var t in e.classes)e.classes.hasOwnProperty(t)&&n.push(l(t,i));return n.length&&(r.className=n.join(" ")),r}throw new Error("Unknown node type '"+e.type+"'")},e.prototype.make=function(e){var r=this,t=[];if(!e)return this.definition.children.forEach(function(e){t=t.concat(r.make(e))}),t;for(var n=0;n<e.repeat;++n)if("group"==e.type)e.children&&e.children.forEach(function(e){var n=r.make(e);t=t.concat(n)});else{var i=r._make_node(e,n);e.children&&e.children.forEach(function(e){var t=r.make(e);t.forEach(function(e){i.appendChild(e)})}),t.push(i)}return t},e.prototype.insert=function(e){var t=this.make();t.forEach(function(t){e.appendChild(t)})},window.zen=e}();